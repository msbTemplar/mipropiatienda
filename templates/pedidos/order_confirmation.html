{# mitienda/templates/pedidos/order_confirmation.html #}
{% extends 'base.html' %}
{% load static %} {# Asegúrate de que tienes 'django.contrib.staticfiles' en INSTALLED_APPS si usas static #}

{% block title %}Confirmación de Pedido - Mi Tienda Online{% endblock %}

{% block content %}
    <div class="container my-5"> {# Usar un contenedor para mejor espaciado #}
        <div class="card shadow-sm mx-auto" style="max-width: 800px;">
            <div class="card-body p-4 p-md-5 text-center"> {# Ajuste de padding para pantallas pequeñas #}
                <h1 class="card-title text-success mb-4 fs-3"><i class="bi bi-check-circle-fill me-2"></i> ¡Pedido Realizado con Éxito!</h1>
                <p class="lead mb-4">Tu pedido con número **#{{ pedido.id }}** ha sido recibido y está siendo procesado.</p>
                {# Asegúrate de que 'email' sea el campo correcto en tu modelo Pedido para el correo del cliente #}
                <p class="mb-4">Recibirás un email de confirmación en **{{ pedido.email_envio|default:"tu correo electrónico" }}** con los detalles de tu compra.</p>

                <h4 class="mt-5 mb-3 text-start">Detalles del Pedido</h4>
                <div class="table-responsive mb-4">
                    <table class="table table-striped table-bordered text-start align-middle"> {# align-middle para centrado vertical #}
                        <thead>
                            <tr>
                                <th scope="col">Producto</th>
                                <th scope="col">Variación</th>
                                <th scope="col" class="text-center">Cantidad</th>
                                <th scope="col" class="text-end">Precio Unitario</th>
                                <th scope="col" class="text-end">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items_pedido %}
                                <tr>
                                    <td>{{ item.variacion_producto.producto.nombre }}</td>
                                    {# Django llama automáticamente al método __str__ si no especificas un atributo #}
                                    <td>{{ item.variacion_producto }}</td> 
                                    <td class="text-center">{{ item.cantidad }}</td>
                                    {# Usar 'item.precio' si ese es el campo en tu ItemPedido #}
                                    <td class="text-end">{{ item.precio|floatformat:2 }} €</td> {# Añadir un símbolo de moneda #}
                                    <td class="text-end">{{ item.get_cost|floatformat:2 }} €</td> {# Asumo que get_cost() está definido en ItemPedido #}
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">No hay productos en este pedido.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="4" class="text-end">Total del Pedido:</th>
                                <th class="text-end">{{ total_pedido|floatformat:2 }} €</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <h4 class="mt-4 mb-3 text-start">Información de Envío</h4>
                <div class="card text-start p-3 bg-light mb-4">
                    {# Asumiendo que tu modelo Pedido tiene estos campos. Ajusta según sea necesario. #}
                    <p class="mb-1"><strong>Nombre:</strong> {{ pedido.nombre_envio }}</p>
                    <p class="mb-1"><strong>Email:</strong> {{ pedido.email_envio }}</p>
                    <p class="mb-1"><strong>Dirección:</strong> {{ pedido.direccion_envio_line1 }}{% if pedido.direccion_envio_line2 %}, {{ pedido.direccion_envio_line2 }}{% endif %}</p>
                    <p class="mb-1"><strong>Ciudad:</strong> {{ pedido.ciudad_envio }}, {{ pedido.codigo_postal_envio }}</p>
                    <p class="mb-1"><strong>País:</strong> {{ pedido.pais_envio }}</p>
                    <p class="mb-0"><strong>Teléfono:</strong> {{ pedido.telefono_envio|default:"N/A" }}</p>
                </div>

                <a href="{% url 'productos:productos_listado' %}" class="btn btn-primary btn-lg mt-3">Seguir Comprando</a>
                
            </div>
        </div>
    </div>
{% endblock %}